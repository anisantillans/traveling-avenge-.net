function arrayObjectIndexOf(a, d, e) { for (var t = 0, i = a.length; t < i; t++) if (a[t][e] == d) return t; return -1 } function listPedidos() { if (null != localStorage.detallePedido && (detallePedido = JSON.parse(localStorage.getItem("detallePedido")), 0 != detallePedido.length)) { $("#pedido-badge, #cantidad-pedido").css("display", "").text(detallePedido.length); for (var a = $("#pedido-badge").data("url"), d = 0; d < detallePedido.length; d++) { var e = { EquipoId: detallePedido[d].EquipoId }; $.ajax({ type: "POST", url: a, data: e, success: function (a) { var d = arrayObjectIndexOf(detallePedido, a.EquipoId, "EquipoId"), e = '<li class="available" data-equipo-id="' + a.EquipoId + '"><a><div class="notice-icon"><i class="fa fa-mobile"></i></div><div><span class="name"><span class="name"><strong>' + a.Nombre + '</strong><a href="#" class="remove-pedido text-danger pull-right"><i class="fa fa-trash fa-2x "></i></a><span class="time small" data-cantidad="' + a.EquipoId + '">Cantidad: ' + detallePedido[d].Cantidad + "</span></span></div></a></li>"; $("ul#shopping-cart").append(e) }, error: function () { console.error("error") } }) } updateUrl(detallePedido) } } function deletePedidos() { localStorage.removeItem("detallePedido"), $("#pedido-badge").css("display", "none"), $("ul#shopping-cart").html(""); var a = $("#make-pedido"), d = a.data("href"); a.attr("href", d), a.find("span").removeClass("text-success"), listPedidos() } function updateUrl(a) { var d = $("#make-pedido"), e = d.data("href"); if (0 == a.length) d.attr("href", e), d.find("span").removeClass("text-success"); else { for (var t = "", i = 0; i < a.length; i++) t += a[i].EquipoId + "," + a[i].Cantidad + (a.length == i + 1 ? "" : ";"); d.attr("href", e + "?l=" + t), d.find("span").addClass("text-success") } } function deletePedido(a) { try { if (null == localStorage.detallePedido) return !1; for (var d = JSON.parse(localStorage.getItem("detallePedido")), e = [], t = 0; t < d.length; t++) d[t].EquipoId != a && e.push(d[t]); return localStorage.setItem("detallePedido", JSON.stringify(e)), !0 } catch (a) { return !1 } } $(function () { listPedidos(), $(document).on("click", ".new-pedido", function () { $("#modal-equipoId, #modal-cantidad").val(""); var a = $(this).data("equipo-id"), d = $(this).data("nombre"), e = $(this).data("max"); $("#modal-pedido-titulo").text(d), $("#modal-equipoId").val(a), $("#modal-cantidad").attr("max", e) }), $("#add-pedido").on("click", function () { var a = $(this).data("url"), d = { EquipoId: $("#modal-equipoId").val(), Cantidad: $("#modal-cantidad").val() }, e = { EquipoId: d.EquipoId }, t = []; null != localStorage.detallePedido && (t = JSON.parse(localStorage.getItem("detallePedido"))); var i = arrayObjectIndexOf(t, d.EquipoId, "EquipoId"), l = !1; -1 == i ? t.push(d) : (l = !0, t[i].Cantidad = d.Cantidad), localStorage.setItem("detallePedido", JSON.stringify(t)), $("#pedido-badge, #cantidad-pedido").css("display", "").text(t.length), $.ajax({ type: "POST", url: a, data: e, success: function (a) { if (l) $("[data-cantidad=" + a.EquipoId + "]").text("Cantidad: " + t[i].Cantidad); else { var e = '<li class="available" data-equipo-id="' + d.EquipoId + '"><a><div class="notice-icon"><i class="fa fa-mobile"></i></div><div><span class="name"><strong>' + a.Nombre + '</strong><a href="#" class="remove-pedido text-danger pull-right"><i class="fa fa-trash fa-2x "></i></a><span class="time small" data-cantidad="' + a.EquipoId + '">Cantidad: ' + d.Cantidad + "</span></span></div></a></li>"; $("ul#shopping-cart").append(e) } }, error: function () { console.error("error") } }), $("#modal-pedido").modal("hide"), updateUrl(t) }), $(document).on("click", ".remove-pedido", function () { var a = $(this).closest("li"), d = a.data("equipo-id"); if (console.log(d), deletePedido(d) && a.remove(), null != localStorage.detallePedido) { var e = JSON.parse(localStorage.getItem("detallePedido")); 0 == e.length ? ($("#pedido-badge").css("display", "none"), $("#cantidad-pedido").css("display", "").text(e.length)) : $("#pedido-badge, #cantidad-pedido").css("display", "").text(e.length), updateUrl(e) } }) });